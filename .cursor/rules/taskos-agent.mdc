---
description: TaskOS task lifecycle - update task status and log activity when working on tasks sent from the TaskOS VS Code extension
globs:
alwaysApply: true
---

# TaskOS Agent Integration

When you receive a task from the TaskOS VS Code extension, a context file exists at `.taskos/task-<taskId>.json`.
The extension already set the task status to **in_progress** when it dispatched the task.

The helper script `taskos-update-task.mjs` communicates with the TaskOS API using the `TASKOS_API_KEY` environment variable.

## After completing implementation

**ALWAYS** run this as your last action, before presenting your summary:

```bash
node taskos-update-task.mjs done "<taskId>" "Concise summary: what was implemented, what files changed, key decisions."
```

The taskId is included in the prompt context. Use it literally (the full UUID).

The summary should be 1-3 sentences describing what was actually done. Examples:
- "Implemented AES-256-GCM encryption with base64url encoding. Added key validation at startup."
- "Fixed rate limiting to key by IP+identifier. Added logging on rate limit hits."

## To log progress during work (optional)

```bash
node taskos-update-task.mjs log "<taskId>" "Description of what was just done"
```

## To mark a step/checklist item as completed (optional)

If the task has steps with stepIds listed in the prompt:

```bash
node taskos-update-task.mjs step "<taskId>" "<stepId>" completed
```

## Rules

1. **Never skip** the `done` command -- it closes the feedback loop in TaskOS
2. **The summary matters** -- write something meaningful, not "done" or "completed"
3. If `taskos-update-task.mjs` fails (missing env var, network error), log the error but **continue with your work** -- don't block on it
4. The script is **idempotent** -- safe to run twice; duplicate calls produce no duplicate entries
5. **Multiple tasks**: each task has its own `.taskos/task-<taskId>.json`. Always use the specific taskId from the prompt

## What the script does

- `done` -- sets task status to "done" in TaskOS and logs a completion activity with git metadata
- `log` -- appends an activity log entry visible in the TaskOS web app and extension
- `step` -- marks a specific checklist step as completed

The API key is read from `TASKOS_API_KEY` env var. It is **never** stored in any file in the repo.
